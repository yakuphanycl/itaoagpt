name: CI

on:
  push:
  pull_request:

jobs:
  windows:
    runs-on: windows-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Create test log (CI fixture)
        shell: pwsh
        run: |
          @"
          2026-02-24 11:00:00 INFO boot
          2026-02-24 11:00:01 WARN cache miss
          2026-02-24 11:00:02 ERROR db timeout after 2000ms
          2026-02-24 11:00:03 INFO retry
          2026-02-24 11:00:04 CRITICAL out of memory
          "@ | Set-Content -LiteralPath .\tmp_test.log -Encoding UTF8

      - name: Install (editable)
        shell: pwsh
        run: |
          python -m pip install --upgrade pip
          python -m pip install -e .

      - name: Run release_check (fast)
        shell: pwsh
        run: |
          .\tools\release_check.ps1

      - name: Run release_check (wheel gate)
        shell: pwsh
        run: |
          .\tools\release_check.ps1 -Wheel
